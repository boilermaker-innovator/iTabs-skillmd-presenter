<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iTabs SKILL.md Presenter</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0f1419;
            color: #e7e9ea;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        h1 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 10px;
            color: #7856ff;
        }
        
        .subtitle {
            text-align: center;
            color: #8b98a5;
            margin-bottom: 30px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 800px) {
            .grid { grid-template-columns: 1fr; }
        }
        
        .panel {
            background: #1a1f26;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #2f3336;
        }
        
        .panel h2 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: #8b98a5;
        }
        
        textarea {
            width: 100%;
            height: 350px;
            background: #0f1419;
            border: 1px solid #2f3336;
            border-radius: 8px;
            padding: 15px;
            color: #e7e9ea;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
        }
        
        textarea:focus { outline: none; border-color: #7856ff; }
        
        .btn-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-primary { background: #7856ff; color: white; }
        .btn-primary:hover { background: #6344dd; }
        
        .btn-secondary { background: #2f3336; color: #e7e9ea; }
        .btn-secondary:hover { background: #3f4448; }
        
        .btn-green { background: #00ba7c; color: white; }
        .btn-green:hover { background: #00a06a; }
        
        .preview {
            background: #0f1419;
            border-radius: 8px;
            padding: 20px;
            min-height: 350px;
            border: 1px solid #2f3336;
        }
        
        .preview-empty {
            color: #8b98a5;
            text-align: center;
            padding-top: 100px;
        }
        
        /* iTabs styles */
        .skill-header {
            background: linear-gradient(135deg, rgba(120,86,255,0.2), rgba(29,155,240,0.2));
            border: 1px solid #7856ff;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .skill-header h3 { color: #7856ff; margin-bottom: 8px; }
        .skill-header p { color: #8b98a5; font-size: 14px; }
        
        .itab {
            background: #1a1f26;
            border: 1px solid #2f3336;
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .itab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            cursor: pointer;
        }
        
        .itab-header:hover { background: #242b35; }
        
        .itab-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .itab-num {
            width: 28px;
            height: 28px;
            background: #7856ff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .itab-name { font-weight: 600; }
        
        .itab-toggle {
            width: 26px;
            height: 26px;
            background: #7856ff;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .itab-toggle.open { background: #00ba7c; }
        
        .itab-content {
            display: none;
            padding: 15px;
            border-top: 1px solid #2f3336;
            color: #8b98a5;
        }
        
        .itab-content.show { display: block; }
        .itab-content p { margin: 10px 0; }
        .itab-content ul { margin: 10px 0; padding-left: 20px; }
        .itab-content li { margin: 5px 0; }
        .itab-content strong { color: #e7e9ea; }
        .itab-content code { background: #0f1419; padding: 2px 6px; border-radius: 4px; }
        .itab-content pre { background: #0f1419; padding: 12px; border-radius: 6px; overflow-x: auto; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>iTabs SKILL.md Presenter</h1>
        <p class="subtitle">Ugly file in ‚Üí Beautiful preview out</p>
        
        <div class="grid">
            <div class="panel">
                <h2>üìÑ Paste SKILL.md</h2>
                <textarea id="input" placeholder="Paste your SKILL.md content here..."></textarea>
                <div class="btn-row">
                    <button class="btn-primary" id="convertBtn">Convert to iTabs</button>
                    <button class="btn-secondary" id="exampleBtn">Load Example</button>
                    <button class="btn-secondary" id="clearBtn">Clear</button>
                </div>
            </div>
            
            <div class="panel">
                <h2>üëÅÔ∏è Preview</h2>
                <div class="preview" id="preview">
                    <div class="preview-empty">Paste a SKILL.md and click Convert</div>
                </div>
                <div class="btn-row">
                    <button class="btn-green" id="downloadBtn" style="display:none;">Download HTML</button>
                </div>
            </div>
        </div>
    </div>

<script>
// Store parsed data
var parsedData = null;

// Get elements
var input = document.getElementById('input');
var preview = document.getElementById('preview');
var convertBtn = document.getElementById('convertBtn');
var exampleBtn = document.getElementById('exampleBtn');
var clearBtn = document.getElementById('clearBtn');
var downloadBtn = document.getElementById('downloadBtn');

// Convert button
convertBtn.onclick = function() {
    var text = input.value.trim();
    if (!text) {
        alert('Please paste SKILL.md content first');
        return;
    }
    parseAndRender(text);
};

// Example button
exampleBtn.onclick = function() {
    input.value = '---\nname: rsa-compliance-helper\ndescription: Helps hospitality workers understand RSA rules for serving alcohol responsibly.\n---\n\n# RSA Compliance Helper\n\nYou are helping hospitality workers in Australia understand RSA rules.\n\n## Signs of Intoxication\n\nLook for these signs:\n\n- Slurred speech\n- Loss of coordination\n- Loud behaviour\n- Aggressive attitude\n- Drowsy or falling asleep\n- Spilling drinks\n\n**Important:** Look for multiple signs, not just one.\n\n## How to Refuse Service\n\nFollow these steps:\n\n1. Stay calm and polite\n2. Be firm but not aggressive\n3. Say "I cannot serve you any more alcohol tonight"\n4. Offer water or food instead\n5. Get manager if they argue\n\n## When to Call for Help\n\nCall security when:\n\n- Patron becomes aggressive\n- Patron will not leave\n- Patron tries to drive\n- You feel unsafe';
    parseAndRender(input.value);
};

// Clear button
clearBtn.onclick = function() {
    input.value = '';
    preview.innerHTML = '<div class="preview-empty">Paste a SKILL.md and click Convert</div>';
    downloadBtn.style.display = 'none';
    parsedData = null;
};

// Download button
downloadBtn.onclick = function() {
    if (!parsedData) return;
    var html = generateHTML();
    var blob = new Blob([html], {type: 'text/html'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = parsedData.name.replace(/[^a-z0-9]/gi, '-').toLowerCase() + '-itabs.html';
    a.click();
};

// Parse and render
function parseAndRender(text) {
    // Parse frontmatter
    var name = 'Untitled Skill';
    var description = 'No description';
    var body = text;
    
    if (text.indexOf('---') === 0) {
        var parts = text.split('---');
        if (parts.length >= 3) {
            var fm = parts[1];
            body = parts.slice(2).join('---');
            
            var nameMatch = fm.match(/name:\s*(.+)/);
            if (nameMatch) name = nameMatch[1].trim();
            
            var descMatch = fm.match(/description:\s*(.+)/);
            if (descMatch) description = descMatch[1].trim();
        }
    }
    
    // Parse sections
    var sections = [];
    var lines = body.split('\n');
    var current = null;
    
    for (var i = 0; i < lines.length; i++) {
        var line = lines[i];
        if (line.indexOf('## ') === 0) {
            if (current) sections.push(current);
            current = { title: line.substring(3).trim(), content: [] };
        } else if (line.indexOf('# ') === 0 && !current) {
            current = { title: line.substring(2).trim(), content: [] };
        } else if (current) {
            current.content.push(line);
        }
    }
    if (current) sections.push(current);
    
    if (sections.length === 0) {
        sections.push({ title: 'Overview', content: body.split('\n') });
    }
    
    parsedData = { name: name, description: description, sections: sections };
    
    // Render preview
    var html = '<div class="skill-header"><h3>' + escapeHtml(name) + '</h3><p>' + escapeHtml(description) + '</p></div>';
    
    for (var j = 0; j < sections.length; j++) {
        var s = sections[j];
        var content = parseContent(s.content.join('\n'));
        html += '<div class="itab">';
        html += '<div class="itab-header" onclick="toggleItab(this)">';
        html += '<div class="itab-title"><span class="itab-num">' + (j+1) + '</span><span class="itab-name">' + escapeHtml(s.title) + '</span></div>';
        html += '<button class="itab-toggle">+</button>';
        html += '</div>';
        html += '<div class="itab-content">' + content + '</div>';
        html += '</div>';
    }
    
    preview.innerHTML = html;
    downloadBtn.style.display = 'block';
}

// Toggle section
function toggleItab(header) {
    var content = header.nextElementSibling;
    var btn = header.querySelector('.itab-toggle');
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        btn.classList.remove('open');
        btn.textContent = '+';
    } else {
        content.classList.add('show');
        btn.classList.add('open');
        btn.textContent = '-';
    }
}

// Parse markdown content
function parseContent(text) {
    if (!text.trim()) return '<p><em>No content</em></p>';
    
    // Code blocks
    text = text.replace(/```[\s\S]*?```/g, function(m) {
        return '<pre><code>' + escapeHtml(m.replace(/```\w*/g, '').trim()) + '</code></pre>';
    });
    
    // Bold
    text = text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
    
    // Inline code
    text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
    
    // Lists
    var lines = text.split('\n');
    var result = [];
    var inList = false;
    
    for (var i = 0; i < lines.length; i++) {
        var line = lines[i];
        if (line.indexOf('- ') === 0) {
            if (!inList) { result.push('<ul>'); inList = true; }
            result.push('<li>' + line.substring(2) + '</li>');
        } else if (line.match(/^\d+\. /)) {
            if (!inList) { result.push('<ul>'); inList = true; }
            result.push('<li>' + line.replace(/^\d+\. /, '') + '</li>');
        } else {
            if (inList) { result.push('</ul>'); inList = false; }
            if (line.trim()) result.push('<p>' + line + '</p>');
        }
    }
    if (inList) result.push('</ul>');
    
    return result.join('') || '<p><em>No content</em></p>';
}

// Escape HTML
function escapeHtml(text) {
    var div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Generate full HTML
function generateHTML() {
    var sections = '';
    for (var i = 0; i < parsedData.sections.length; i++) {
        var s = parsedData.sections[i];
        sections += '<div class="itab"><div class="itab-header" onclick="toggle(this)"><div class="itab-title"><span class="itab-num">' + (i+1) + '</span><span class="itab-name">' + escapeHtml(s.title) + '</span></div><button class="itab-toggle">+</button></div><div class="itab-content">' + parseContent(s.content.join('\n')) + '</div></div>';
    }
    
    return '<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>' + escapeHtml(parsedData.name) + '</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,sans-serif;background:#0f1419;color:#e7e9ea;padding:20px;max-width:700px;margin:0 auto;line-height:1.6}.header{background:linear-gradient(135deg,rgba(120,86,255,0.2),rgba(29,155,240,0.2));border:1px solid #7856ff;border-radius:12px;padding:20px;text-align:center;margin-bottom:20px}.header h1{color:#7856ff;font-size:1.5rem;margin-bottom:8px}.header p{color:#8b98a5;font-size:14px}.itab{background:#1a1f26;border:1px solid #2f3336;border-radius:10px;margin-bottom:10px;overflow:hidden}.itab-header{display:flex;justify-content:space-between;align-items:center;padding:15px;cursor:pointer}.itab-header:hover{background:#242b35}.itab-title{display:flex;align-items:center;gap:10px}.itab-num{width:28px;height:28px;background:#7856ff;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold}.itab-name{font-weight:600}.itab-toggle{width:26px;height:26px;background:#7856ff;border:none;border-radius:6px;color:white;font-weight:bold;cursor:pointer}.itab-toggle.open{background:#00ba7c}.itab-content{display:none;padding:15px;border-top:1px solid #2f3336;color:#8b98a5}.itab-content.show{display:block}.itab-content p{margin:10px 0}.itab-content ul{margin:10px 0;padding-left:20px}.itab-content li{margin:5px 0}.itab-content strong{color:#e7e9ea}.itab-content code{background:#0f1419;padding:2px 6px;border-radius:4px}.itab-content pre{background:#0f1419;padding:12px;border-radius:6px;overflow-x:auto;margin:10px 0}.footer{text-align:center;padding:20px;color:#8b98a5;font-size:12px}</style></head><body><div class="header"><h1>' + escapeHtml(parsedData.name) + '</h1><p>' + escapeHtml(parsedData.description) + '</p></div>' + sections + '<div class="footer">Created with iTabs SKILL.md Presenter</div><script>function toggle(h){var c=h.nextElementSibling,b=h.querySelector(".itab-toggle");if(c.classList.contains("show")){c.classList.remove("show");b.classList.remove("open");b.textContent="+"}else{c.classList.add("show");b.classList.add("open");b.textContent="-"}}<\/script></body></html>';
}
</script>
</body>
</html>
